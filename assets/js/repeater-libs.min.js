!function(t){"use strict";var e=function(t){return t},n=function(e){return t.isArray(e)},r=function(t){return!n(t)&&t instanceof Object},i=function(e,n){return t.inArray(n,e)},u=function(t,e){return-1!==i(t,e)},a=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(t[n],n,t)},c=function(t){return t[t.length-1]},o=function(t){return Array.prototype.slice.call(t)},f=function(){var t={};return a(o(arguments),function(e){a(e,function(e,n){t[n]=e})}),t},p=function(t,e){var n=[];return a(t,function(t,r,i){n.push(e(t,r,i))}),n},s=function(t,e,n){var r={};return a(t,function(t,i,u){i=n?n(i,t):i,r[i]=e(t,i,u)}),r},l=function(t,e,r){return n(t)?p(t,e):s(t,e,r)},h=function(t,e){return l(t,function(t){return t[e]})},d=function(t,e){var r;return n(t)?(r=[],a(t,function(t,n,i){e(t,n,i)&&r.push(t)})):(r={},a(t,function(t,n,i){e(t,n,i)&&(r[n]=t)})),r},v=function(t,e,n){return l(t,function(t){return t[e].apply(t,n||[])})},m=function(t){var e={};return(t=t||{}).publish=function(t,n){a(e[t],function(t){t(n)})},t.subscribe=function(t,n){e[t]=e[t]||[],e[t].push(n)},t.unsubscribe=function(t){a(e,function(e){var n=i(e,t);-1!==n&&e.splice(n,1)})},t};!function(t){var e=function(t,e){var n=m(),r=t.$;return n.getType=function(){throw'implement me (return type. "text", "radio", etc.)'},n.$=function(t){return t?r.find(t):r},n.disable=function(){n.$().prop("disabled",!0),n.publish("isEnabled",!1)},n.enable=function(){n.$().prop("disabled",!1),n.publish("isEnabled",!0)},e.equalTo=function(t,e){return t===e},e.publishChange=function(){var t;return function(r,i){var u=n.get();e.equalTo(u,t)||n.publish("change",{e:r,domElement:i}),t=u}}(),n},o=function(t,n){var r=e(t,n);return r.get=function(){return r.$().val()},r.set=function(t){r.$().val(t)},r.clear=function(){r.set("")},n.buildSetter=function(t){return function(e){t.call(r,e)}},r},f=function(t,e){t=n(t)?t:[t],e=n(e)?e:[e];var r=!0;return t.length!==e.length?r=!1:a(t,function(t){u(e,t)||(r=!1)}),r},p=function(t){var e={},n=o(t,e);return n.getType=function(){return"button"},n.$().on("change",function(t){e.publishChange(t,this)}),n},s=function(e){var r={},i=o(e,r);return i.getType=function(){return"checkbox"},i.get=function(){var e=[];return i.$().filter(":checked").each(function(){e.push(t(this).val())}),e},i.set=function(e){e=n(e)?e:[e],i.$().each(function(){t(this).prop("checked",!1)}),a(e,function(t){i.$().filter('[value="'+t+'"]').prop("checked",!0)})},r.equalTo=f,i.$().change(function(t){r.publishChange(t,this)}),i},l=function(t){var e=w(t,{});return e.getType=function(){return"email"},e},h=function(n){var r={},i=e(n,r);return i.getType=function(){return"file"},i.get=function(){return c(i.$().val().split("\\"))},i.clear=function(){this.$().each(function(){t(this).wrap("<form>").closest("form").get(0).reset(),t(this).unwrap()})},i.$().change(function(t){r.publishChange(t,this)}),i},d=function(t){var e={},n=o(t,e);return n.getType=function(){return"hidden"},n.$().change(function(t){e.publishChange(t,this)}),n},g=function(n){var r={},i=e(n,r);return i.getType=function(){return"file[multiple]"},i.get=function(){var t,e=i.$().get(0).files||[],n=[];for(t=0;t<(e.length||0);t+=1)n.push(e[t].name);return n},i.clear=function(){this.$().each(function(){t(this).wrap("<form>").closest("form").get(0).reset(),t(this).unwrap()})},i.$().change(function(t){r.publishChange(t,this)}),i},y=function(t){var e={},r=o(t,e);return r.getType=function(){return"select[multiple]"},r.get=function(){return r.$().val()||[]},r.set=function(t){r.$().val(""===t?[]:n(t)?t:[t])},e.equalTo=f,r.$().change(function(t){e.publishChange(t,this)}),r},b=function(t){var e=w(t,{});return e.getType=function(){return"password"},e},$=function(e){var n={},r=o(e,n);return r.getType=function(){return"radio"},r.get=function(){return r.$().filter(":checked").val()||null},r.set=function(e){e?r.$().filter('[value="'+e+'"]').prop("checked",!0):r.$().each(function(){t(this).prop("checked",!1)})},r.$().change(function(t){n.publishChange(t,this)}),r},k=function(t){var e={},n=o(t,e);return n.getType=function(){return"range"},n.$().change(function(t){e.publishChange(t,this)}),n},x=function(t){var e={},n=o(t,e);return n.getType=function(){return"select"},n.$().change(function(t){e.publishChange(t,this)}),n},w=function(t){var e={},n=o(t,e);return n.getType=function(){return"text"},n.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),n},T=function(t){var e={},n=o(t,e);return n.getType=function(){return"textarea"},n.$().on("change keyup keydown",function(t){e.publishChange(t,this)}),n},C=function(t){var e=w(t,{});return e.getType=function(){return"url"},e},V=function(e){var n={},u=e.$,c=e.constructorOverride||{button:p,text:w,url:C,email:l,password:b,range:k,textarea:T,select:x,"select[multiple]":y,radio:$,checkbox:s,file:h,"file[multiple]":g,hidden:d},o=function(e,i){(r(i)?i:u.find(i)).each(function(){var r=t(this).attr("name");n[r]=c[e]({$:t(this)})})},f=function(e,o){var f=[],p=r(o)?o:u.find(o);r(o)?n[p.attr("name")]=c[e]({$:p}):(p.each(function(){-1===i(f,t(this).attr("name"))&&f.push(t(this).attr("name"))}),a(f,function(t){n[t]=c[e]({$:u.find('input[name="'+t+'"]')})}))};return u.is("input, select, textarea")?u.is('input[type="button"], button, input[type="submit"]')?o("button",u):u.is("textarea")?o("textarea",u):u.is('input[type="text"]')||u.is("input")&&!u.attr("type")?o("text",u):u.is('input[type="password"]')?o("password",u):u.is('input[type="email"]')?o("email",u):u.is('input[type="url"]')?o("url",u):u.is('input[type="range"]')?o("range",u):u.is("select")?u.is("[multiple]")?o("select[multiple]",u):o("select",u):u.is('input[type="file"]')?u.is("[multiple]")?o("file[multiple]",u):o("file",u):u.is('input[type="hidden"]')?o("hidden",u):u.is('input[type="radio"]')?f("radio",u):u.is('input[type="checkbox"]')?f("checkbox",u):o("text",u):(o("button",'input[type="button"], button, input[type="submit"]'),o("text",'input[type="text"]'),o("password",'input[type="password"]'),o("email",'input[type="email"]'),o("url",'input[type="url"]'),o("range",'input[type="range"]'),o("textarea","textarea"),o("select","select:not([multiple])"),o("select[multiple]","select[multiple]"),o("file",'input[type="file"]:not([multiple])'),o("file[multiple]",'input[type="file"][multiple]'),o("hidden",'input[type="hidden"]'),f("radio",'input[type="radio"]'),f("checkbox",'input[type="checkbox"]')),n};t.fn.inputVal=function(e){var n=t(this),r=V({$:n});return n.is("input, textarea, select")?void 0===e?r[n.attr("name")].get():(r[n.attr("name")].set(e),n):void 0===e?v(r,"get"):(a(e,function(t,e){r[e].set(t)}),n)},t.fn.inputOnChange=function(e){var n=t(this),r=V({$:n});return a(r,function(t){t.subscribe("change",function(t){e.call(t.domElement,t.e)})}),n},t.fn.inputDisable=function(){var e=t(this);return v(V({$:e}),"disable"),e},t.fn.inputEnable=function(){var e=t(this);return v(V({$:e}),"enable"),e},t.fn.inputClear=function(){var e=t(this);return v(V({$:e}),"clear"),e}}(jQuery),t.fn.repeaterVal=function(){var e=function(t){if(1===t.length&&(0===t[0].key.length||1===t[0].key.length&&!t[0].key[0]))return t[0].val;a(t,function(t){t.head=t.key.shift()});var n,r=function(){var e={};return a(t,function(t){e[t.head]||(e[t.head]=[]),e[t.head].push(t)}),e}();return/^[0-9]+$/.test(t[0].head)?(n=[],a(r,function(t){n.push(e(t))})):(n={},a(r,function(t,r){n[r]=e(t)})),n};return e(function(t){var e=[];return a(t,function(t,n){var r=[];"undefined"!==n&&(r.push(n.match(/^[^\[]*/)[0]),r=r.concat(l(n.match(/\[[^\]]*\]/g),function(t){return t.replace(/[\[\]]/g,"")})),e.push({val:t,key:r}))}),e}(t(this).inputVal()))},t.fn.repeater=function(n){var r;return(n=n||{}).hasOwnProperty("render")||(n.render={}),t(this).each(function(){var i=t(this),u=n.show||function(){t(this).show()},o=n.hide||function(t){t()},p=i.find("[data-repeater-list]").first(),s=function(e,n){return e.filter(function(){return!n||0===t(this).closest(h(n,"selector").join(",")).length})},v=function(){return s(p.find("[data-repeater-item]"),n.repeaters)},m=p.find("[data-repeater-item]").first().clone().hide(),g=s(s(t(this).find("[data-repeater-item]"),n.repeaters).first().find("[data-repeater-delete]"),n.repeaters);n.isFirstItemUndeletable&&g&&g.remove();var y=function(){var t=p.data("repeater-list");return n.$parent?n.$parent.data("item-name")+"["+t+"]":t},b=function(e){n.repeaters&&e.each(function(){var e=t(this);a(n.repeaters,function(t){e.find(t.selector).repeater(f(t,{$parent:e}))})})},$=function(t,e,n){t&&a(t,function(t){n.call(e.find(t.selector)[0],t)})},k=function(e,n,r){e.each(function(e){var i=t(this);i.data("item-name",n+"["+e+"]"),s(i.find("[name]"),r).each(function(){var u=t(this),a=u.attr("name").match(/\[[^\]]+\]/g),o=a?c(a).replace(/\[|\]/g,""):u.attr("name"),f=n+"["+e+"]["+o+"]"+(u.is(":checkbox")&&u.attr("multiple")?"[]":""),p=n+"-"+e+"-"+o;u.attr("name",f);var l=u.closest(".tpfw_form_row");l.find(".tpfw-field").attr("id",p),l.find("label.repeater-field-label").attr("for",p),$(r,i,function(r){var i=t(this);k(s(i.find("[data-repeater-item]"),r.repeaters||[]),n+"["+e+"]["+i.find("[data-repeater-list]").first().data("repeater-list")+"]",r.repeaters)})})}),p.find("input[name][checked]").removeAttr("checked").prop("checked",!0)};k(v(),y(),n.repeaters),b(v()),n.initEmpty&&v().remove(),n.ready&&n.ready(function(){k(v(),y(),n.repeaters)});var x=function(){var r=function(i,u,c){if(u||n.defaultValues){var o={};s(i.find("[name]"),c).each(function(){var e=t(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];o[e]=t(this).attr("name");var r=u||n.defaultValues,i=t(this),a=i.attr("data-type");if(void 0!==a&&n.render.hasOwnProperty(a)){var c=void 0!==r[e]?r[e]:"";n.render[a](i,e,c)}});var f=[];i.inputVal(l(d(u||n.defaultValues,function(t,e){var n=i.find(".repeater_field_"+e+".show_label");if(n.length){var r=n.find(".repeater-col-label label").text();""!=r&&(r=r.replace(":",""),f.push(r+": "+t))}return o[e]}),e,function(t){return o[t]})),f.length&&i.find(".js-heading-text").text(f.join(", "))}$(c,i,function(e){var n=t(this);s(n.find("[data-repeater-item]"),e.repeaters).each(function(){var i=n.find("[data-repeater-list]").data("repeater-list");if(u&&u[i]){var c=t(this).clone();n.find("[data-repeater-item]").remove(),a(u[i],function(t){var i=c.clone();r(i,t,e.repeaters||[]),n.find("[data-repeater-list]").append(i)})}else r(t(this),e.defaultValues,e.repeaters||[])})})};return function(e,i){p.append(e),k(v(),y(),n.repeaters),e.find("[name]").each(function(){t(this).inputClear()}),r(e,i||n.defaultValues,n.repeaters),"function"==typeof Tpfw_Repeater_Item&&new Tpfw_Repeater_Item(p,e,T),T=!1}}(),w=function(t){var e=m.clone();x(e,t),n.repeaters&&b(e),u.call(e.get(0))};r=function(t){v().remove(),a(t,w)};var T=!1;s(i.find("[data-repeater-create]"),n.repeaters).click(function(){T=!0,w()}),p.on("click","[data-repeater-delete]",function(){var e=t(this).closest("[data-repeater-item]").get(0);o.call(e,function(){t(e).remove(),k(v(),y(),n.repeaters)})})}),this.setList=r,this}}(jQuery);