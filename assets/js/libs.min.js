jQuery(function(t){"use strict";var e=t(document);t.fn.tpfwImagePicker=function(){var n={},a=function(t){var e=[];if(""!=t){var n=t.split(",");for(var a in n){var i=n[a].split("|");e.push(i[0])}}return e};e.on("click",".tpfw-image_picker .add_images",function(e){e.preventDefault();var i=t(this).closest(".tpfw-image_picker"),l=i.find('input[type="hidden"]');n[i.attr("id")]?n[i.attr("id")].open():(n[i.attr("id")]=wp.media.frames.file_frame=wp.media({title:"Add Images",button:{text:"Add Images"},library:{type:"image"},multiple:i.data("multiple")}),n[i.attr("id")].on("open",function(){var e,o;""!=(e=a(l.val()))&&(o=n[i.attr("id")].state().get("selection"),t(e).each(function(t,e){var n;(n=wp.media.attachment(e)).fetch(),o.add(n?[n]:[])}))}),n[i.attr("id")].on("select",function(){var e,o;e=[],o=n[i.attr("id")].state().get("selection");var r=a(l.val()),s="";o.map(function(n){var a=(n=n.toJSON()).sizes.hasOwnProperty("thumbnail")?n.sizes.thumbnail.url:n.url;""!=r&&-1!==t.inArray(n.id.toString(),r)||(s+='<li class="added" data-id="'+n.id+'">\n                                    <div class="inner">\n                                        <img alt="'+n.title+'" src="'+a+'"/>\n                                    </div>\n                                    <a href="#" class="remove"></a>\n                                </li>',a=a.replace(tpfw_var.upload_url,""),e.push(n.id+"|"+encodeURIComponent(a)))}),e.length>0&&(i.data("multiple")?(""!=r&&(e=r.concat(e)),i.find(".image_list").append(s)):i.find(".image_list").html(s),l.val(e).change())}),n[i.attr("id")].open())}),e.on("click",".tpfw-image_picker .remove",function(e){e.preventDefault();var n=t(this),a=n.closest(".tpfw-image_picker").find('input[type="hidden"]'),i=a.val(),l=n.closest("li").index();""!=i&&(delete(i=i.split(","))[l],i=i.filter(function(t){return t})),a.val(i).change(),n.closest("li").remove()}),t.fn.sortable&&t(".tpfw-image_picker .image_list").sortable({stop:function(e,n){var a=[],i=t(n.item[0]).parent();i.find("li").each(function(){a.push(t(this).attr("data-id"))}),i.closest(".tpfw-image_picker").find('input[type="hidden"]').val(a)}})},t.fn.tpfwLink=function(){e.on("click",".tpfw-link .link_button",function(e){e.preventDefault();var n,a,i,l,o,r,s,p,c;n=t(this).closest(".tpfw-link"),a=n.find("input.tpfw_value"),i=n.find(".url-label"),l=n.find(".title-label"),o=a.data("json"),r=t("#wp-link-submit"),s=t('<input type="button" name="tpfw_link-submit" id="tpfw_link-submit" class="button-primary" value="Set Link">'),r.hide(),t("#tpfw_link-submit").remove(),s.insertBefore(r),p=t('<div class="link-target tpfw-link-nofollow"><label><span></span> <input type="checkbox" id="tpfw-link-nofollow"> Add nofollow option to link</label></div>'),t("#link-options .tpfw-link-nofollow").remove(),p.insertAfter(t("#link-options .link-target")),setTimeout(function(){var e=t("#most-recent-results").css("top");t("#most-recent-results").css("top",parseInt(e)+p.height())},200),(c=window.wpLink).open("content"),"string"==typeof o.url&&t("#wp-link-url").length?t("#wp-link-url").val(o.url):t("#url-field").val(o.url),"string"==typeof o.url&&t("#wp-link-text").length?t("#wp-link-text").val(o.title):t("#link-title-field").val(o.title),t("#wp-link-target").length?t("#wp-link-target").prop("checked",o.target.length):t("#link-target-checkbox").prop("checked",o.target.length),t("#tpfw-link-nofollow").length&&t("#tpfw-link-nofollow").prop("checked",o.rel.length),s.unbind("click.tpfwLink").bind("click.tpfwLink",function(e){e.preventDefault(),e.stopImmediatePropagation();var n,o={};o.url=t("#wp-link-url").length?t("#wp-link-url").val():t("#url-field").val(),o.title=t("#wp-link-text").length?t("#wp-link-text").val():t("#link-title-field").val();var p=t(t("#wp-link-target").length?"#wp-link-target":"#link-target-checkbox");return o.target=p[0].checked?" _blank":"",o.rel=t("#tpfw-link-nofollow")[0].checked?"nofollow":"",n=t.map(o,function(t,e){return"string"==typeof t&&0<t.length?e+":"+encodeURIComponent(t):void 0}).join("|"),a.val(n).change(),a.data("json",o),i.html(o.url+o.target),l.html(o.title),c.close("noReset"),window.wpLink.textarea="",r.show(),s.unbind("click.tpfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.tpfwLink"),p.attr("checked",!1),t("#most-recent-results").css("top",""),t("#tpfw-link-nofollow").attr("checked",!1),!1}),t("#wp-link-cancel").unbind("click.tpfwLink").bind("click.tpfwLink",function(e){return e.preventDefault(),c.close("noReset"),s.unbind("click.tpfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.tpfwLink"),t("#wp-link-close").unbind("click.tpfwCloseLink"),window.wpLink.textarea="",!1}),t("#wp-link-close").unbind("click").bind("click.tpfwCloseLink",function(e){return e.preventDefault(),c.close("noReset"),s.unbind("click.tpfwLink"),s.remove(),t("#wp-link-cancel").unbind("click.tpfwLink"),t("#wp-link-close").unbind("click.tpfwCloseLink"),window.wpLink.textarea="",!1})})},t.fn.tpfwMap=function(){if(window.hasOwnProperty("google"))return this.each(function(e,n){if(!n.id.includes("__i__")){var a=t(this),i={};i.zoom=14,i.map=new google.maps.Map(a.find(".map_canvas")[0],{zoom:4,center:new google.maps.LatLng(40.590377,-97.726872)}),i.marker=null,i.overideMap=function(t){null!=i.marker&&(i.marker.setMap(null),i.marker=null),i.marker=new google.maps.Marker({position:t,draggable:!0,animation:google.maps.Animation.DROP,icon:i.iconMarker}),i.map.setCenter(t),i.map.setZoom(i.zoom),i.marker.setMap(i.map),google.maps.event.addListener(i.marker,"dragend",i.onDragMarker),google.maps.event.addListener(i.map,"zoom_changed",i.onZoomChanged)},i.onDragMarker=function(t){var e=t.latLng,n=e.lat()+","+e.lng()+"|"+i.zoom;a.find("input.tpfw_value").val(n).change()},i.onZoomChanged=function(e){i.zoom=i.map.getZoom();var n=a.find("input.tpfw_value").val();if(""!=t.trim(n)){var l=(n=n.split("|"))[0]+"|"+i.zoom;a.find("input.tpfw_value").val(l).change()}},i.onLoad=function(){var e=a.find("input.tpfw_value").val();if(a.addClass("map_loaded"),""!=t.trim(e)){var n=(e=e.split("|"))[0].split(",");n=new google.maps.LatLng(t.trim(n[0]),t.trim(n[1])),i.zoom=""!=t.trim(e[1])?parseInt(e[1]):14,i.overideMap(n)}},a.find(".js-map_search").geocomplete().bind("geocode:result",function(t,e){var n=e.geometry.location,l=n.lat()+","+n.lng()+"|"+i.zoom;a.find("input.tpfw_value").val(l).change(),i.overideMap(n)}),setTimeout(i.onLoad,500)}})},t.fn.tpfwRepeater=function(){t(this).each(function(){var e=t(this).repeater({defaultValues:{},show:function(){t(this).slideDown()},hide:function(e){t(this).slideUp(e)},ready:function(t){},render:{image_picker:function(e,n,a){var i=a.split(",");if(i.length>0){var l="";t.each(i,function(t,e){2===(e=e.split("|")).length&&(l+='<li class="added" data-id="'+e[0]+'">\n                                                    <div class="inner">\n                                                        <img alt="" src="'+tpfw_var.upload_url+decodeURIComponent(e[1])+'"/>\n                                                    </div>\n                                                    <a href="#" class="remove"></a>\n                                                </li>')}),e.parent().find(".image_list").append(l)}},color_picker:function(e,n,a){e.val(a),e.wpColorPicker({change:function(e,n){t(e.target).val(n.color.toString()).change()}})},icon_picker:function(t,e,n){t.val(n).change(),t.fontIconPicker()},checkbox:function(t,e,n){if(""!=n){n=n.split(",");var a=t.next();for(var i in n)a.find('input[value="'+n[i]+'"]').attr("checked","checked")}},select:function(e,n,a){var i=e.parent().find("select");if(""!=a){"string"==typeof a&&(a=a.split(","));for(var l in a)i.find('option[value="'+a[l]+'"]').attr("selected","selected");i.change()}void 0!==i.attr("multiple")&&i.selectize({plugins:["remove_button","drag_drop"],onChange:function(e){t(this)[0].$wrapper.closest(".repeater-col-field").find("input.tpfw_value").val(e).change()}})},autocomplete:function(t,e,n){var a=t.parent().find("select");if(""!=n){"string"==typeof n&&(n=n.split(","));for(var i in n)a.find('option[value="'+n[i]+'"]').attr("selected","selected");a.change()}a.tpfwAutocomplete()},link:function(t,e,n){var a=n.split("|"),i={};if(a.length>1){for(var l in a){var o=a[l].split(":");i[o[0]]=decodeURIComponent(o[1])}t.data("json",i),t.parent().find(".url-label").html(i.url+i.target),t.parent().find(".title-label").html(i.title)}},datetime:function(t,e,n){t.datetimepicker(t.data())}}}),n=e.data("value");"object"==typeof n&&e.setList(n),e.find("div[data-rpt_dependency]").length&&e.find("div[data-rpt_dependency]").initRepeaterDependency()}),e.on("click",".tpfw-repeater [data-repeater-edit], .tpfw-repeater .tpfw-widget-title h4",function(n){var a=t(this).closest(".tpfw-widget");a.hasClass("open")?a.find(".tpfw-widget-inside").slideUp("fast",function(){a.removeClass("open")}):a.find(".tpfw-widget-inside").slideDown("fast",function(){a.addClass("open"),e.trigger("tpfw-repeater-item-opened",[a])}),n.preventDefault()})},t.fn.tpfwTypography=function(){var e={},n=!1,a=function(e,n,a){var i={"font-family":n.value},l=e.find(".subsets select"),o=e.find(".variants select"),r=l[0].selectize,s=o[0].selectize;if(""!=n.variants){var p=n.variants.split(","),c=[],f=tpfw_var.variants;for(var d in n.variants){m=f.hasOwnProperty(p[d])?f[p[d]]:p[d];c.push({text:m,value:p[d]})}if(s.enable(),s.clearOptions(),s.addOption(c),"object"==typeof a&&a.hasOwnProperty("variants")){var u=a.variants.split(",");s.addItems(u)}else s.addItems(p);i.variants=n.variants}else s.clearOptions(),s.disable();if(""!=n.subsets){var v=n.subsets.split(","),c=[],h=tpfw_var.subsets;for(var d in v){var m=h.hasOwnProperty(v[d])?h[v[d]]:v[d];c.push({text:m,value:v[d]})}if(r.enable(),r.clearOptions(),r.addOption(c),"object"==typeof a&&a.hasOwnProperty("subsets")){var w=a.subsets.split(",");r.addItems(w)}else t.inArray("latin",v)>=0&&(r.addItem("latin"),i.subsets="latin")}else r.clearOptions(),r.disable();"function"==typeof a&&a(i)},i=t(this),l=i.find(".font_family select");i.find(".variants select").selectize({plugins:["remove_button"],create:!1,onChange:function(a){if(!n){var i=t(this)[0].$wrapper.closest(".tpfw-typography"),l=i.data("id"),o=e[l];if(""!=i.data("value")&&o.hasOwnProperty("variants")){o.variants=a.join(",");var r=encodeURIComponent(JSON.stringify(o));e[l]=o,i.find(".tpfw_value").val(r).change()}}}}),i.find(".subsets select").selectize({plugins:["remove_button"],create:!1,onChange:function(a){if(!n){var i=t(this)[0].$wrapper.closest(".tpfw-typography"),l=i.data("id"),o=e[l];if(""!=i.data("value")&&o.hasOwnProperty("subsets")){o.subsets=a.join(",");var r=encodeURIComponent(JSON.stringify(o));e[l]=o,i.find(".tpfw_value").val(r).change()}}}}),l.selectize({labelField:"label",valueField:"value",searchField:"label",create:!1,options:tpfw_var.fonts,render:{option:function(t,e){return"<div class='option' data-value='"+t.value+"' data-variants='"+t.variants+"' data-subsets='"+t.subsets+"'>"+t.label+" </div>"}},onInitialize:function(){var n=t(this)[0].$wrapper.closest(".tpfw-typography"),a=n.data("id");e[a]={};var i=n.data("value");if(""!=i){var l=JSON.parse(decodeURIComponent(i));l.hasOwnProperty("font-family")&&(e[a]=l,t(this)[0].addItem(l["font-family"]))}},onChange:function(i){if(n=!0,""!=i){var l=t(this)[0].$wrapper.closest(".tpfw-typography"),o=l.data("id"),r=e[o];r.hasOwnProperty("font-family")&&r["font-family"]===i?a(l,this.options[i],r):a(l,this.options[i],function(t){r["font-family"]=t["font-family"],r.subsets=t.subsets,r.variants=t.variants;var n=encodeURIComponent(JSON.stringify(r));l.find(".tpfw_value").val(n).change(),e[o]=r}),n=!1}}}),i.on("change",".subrow input, .subrow select",function(n){var a=t(this).data("key"),i=t(this),l=i.closest(".tpfw-typography"),o=l.data("id");if(""!=i.val()){e[o][a]=i.val();var r=encodeURIComponent(JSON.stringify(e[o]));l.find(".tpfw_value").val(r).change()}n.preventDefault()})},t.fn.tpfwAutocomplete=function(){t(this).selectize({valueField:"value",searchField:"label",labelField:"label",options:[],create:!1,plugins:["remove_button","drag_drop"],load:function(e,n){var a=t(this)[0].$wrapper.closest(".tpfw-field"),i=a.data("ajax_type"),l=a.data("min_length");if(e.length<parseInt(l)||!i)return n();var o=a.data("ajax_value");t.ajax({url:ajaxurl,type:"GET",data:{action:"tpfw_autocomplete_"+i,types:o,s:e},error:function(){n()},success:function(t){n(t)}})}})},t.fn.tpfwUpload=function(){var e=t(this);e.on("change",".tpfw_value",function(e){var n=t(this),a=[];n.closest(".tpfw-field").find("tbody tr").each(function(){var e=t(this);a.push({url:e.find('[data-name="url"]').val(),name:e.find('[data-name="name"]').val(),hash:e.find('[data-name="hash"]').val()})}),1==a.length&&""==a[0].url?n.val(""):n.val(JSON.stringify(a)),e.preventDefault()}),e.on("change",'[data-name="name"]',function(e){t(this).closest(".tpfw-field").find(".tpfw_value").change(),e.preventDefault()}),e.on("click","table a.delete",function(e){var n=t(this),a=n.closest(".tpfw-field").find("tbody tr"),i=n.closest(".tpfw-field").find(".tpfw_value");1===a.length?n.closest("tr").find("input").attr("value",""):n.closest("tr").remove(),i.change(),e.preventDefault()}),e.on("click","table a.insert",function(e){var n=t(this).closest("table").find("tbody"),a=n.find("tr:first").clone();a.find("input").attr("value",""),n.append("<tr>"+a.html()+"</tr>"),e.preventDefault()}),e.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(e,n){t(e.target).closest(".tpfw-field").find(".tpfw_value").change()}});var n,a={};t(document.body).on("click",".tpfw-upload .upload_file",function(e){var i=t(this),l=i.closest(".tpfw-field");n=i.closest("tr").find("td.file_url input"),e.preventDefault(),a[l.attr("id")]?a[l.attr("id")].open():(a[l.attr("id")]=wp.media.frames.tpfw_file=wp.media({title:i.data("choose"),library:{type:l.data("mime_types")},button:{text:i.data("update")},multiple:!0}),a[l.attr("id")].on("select",function(){var e="";a[l.attr("id")].state().get("selection").map(function(a){a=a.toJSON();var i=l.data("mime_types");""!=t.trim(i)&&-1!==i.indexOf(a.mime)?a.url&&(e=a.url,n.val(e).change(),l.find(".tpfw_value").change()):alert(tpfw_var.upload_invalid_mime)})}),a[l.attr("id")].open())})},t.fn.initWidgetDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name");if(void 0!=e&&_.isObject(e)){var a="#";t(this).closest(".widget").length&&(a="#widget-"+t(this).closest(".widget").find("input.widget-id").val()+"-");var i=Object.keys(e);_.each(i,function(t){e[a+t]=e[t],delete e[t]}),t("#"+n+".tpfw_value").dependsOn(e)}})},t.fn.initRepeaterDependency=function(){t(this).each(function(){var e=t(this).closest(".tpfw_repeater__item").index(),n=t(this).closest(".tpfw-repeater").attr("data-name")+"-"+e+"-",a=t(this).data("rpt_dependency"),i=t(this).data("param_name");if(void 0!=a&&_.isObject(a)){var l=Object.keys(a);_.each(l,function(t){a["#"+n+t]=a[t],delete a[t]}),t("#"+n+i+".tpfw_value").dependsOn(a)}})},t.fn.initMenuDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name"),a=t(this).data("menu_item");if(void 0!=e&&"object"==typeof e){var i=Object.keys(e);t.each(i,function(t,n){e["#"+n+"-"+a]=e[n],delete e[n]}),t("#"+n+".tpfw_value").dependsOn(e)}})},t.fn.initDependency=function(){t(this).each(function(){var e=t(this).data("dependency"),n=t(this).data("param_name");if(void 0!=e&&"object"==typeof e){var a=Object.keys(e);t.each(a,function(t,n){e["#"+n]=e[n],delete e[n]}),t("#"+n+".tpfw_value").dependsOn(e)}})}});var Tpfw_Repeater_Item=function(t,e,n){"use strict";var a=this;this.list=t,this.container=e,this.control=t.prev(".tpfw_value"),this.container.on("keyup change",".tpfw_value",function(t){a.setValues()}),this.setValues=function(){var t=[];a.list.find("[data-repeater-item]").each(function(){var e={};jQuery(this).find(".tpfw_value").each(function(){var t=jQuery(this);if("radio"!=t.attr("type")||"radio"==t.attr("type")&&t.is(":checked")){var n=jQuery(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];e[n]=jQuery(this).val()}}),t.push(e)}),a.control.val(JSON.stringify(t)).trigger("change")},n&&a.setValues()};